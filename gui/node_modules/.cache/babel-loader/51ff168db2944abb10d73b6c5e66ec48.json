{"ast":null,"code":"import { put, delay } from \"redux-saga/effects\";\nimport * as actions from \"../actions/index\";\nimport axios from \"../../axios/auth\";\nexport function* checkAuthTimeoutSaga(action) {\n  yield delay(action.expirationTime * 1000);\n  yield put(actions.logoutSuccess());\n}\nexport function* logoutSaga() {\n  localStorage.removeItem(\"token\");\n  localStorage.removeItem(\"expirationDate\");\n  localStorage.removeItem(\"userId\");\n  const url = \"logout/\";\n\n  try {\n    const res = yield axios.post(url);\n    yield put(actions.logoutSuccess(res.data));\n  } catch (error) {\n    yield put(actions.authFail(error.response.data));\n  }\n}\nexport function* authCheckState() {\n  const token = localStorage.getItem(\"token\");\n\n  if (!token) {\n    yield put(actions.logout());\n  } else {\n    const expirationDate = yield new Date(localStorage.getItem(\"expirationDate\"));\n\n    if (expirationDate <= new Date()) {\n      yield put(actions.logout());\n    } else {\n      const userId = localStorage.getItem(\"userId\");\n      yield put(actions.authSuccess(token, userId));\n      yield put(actions.checkAuthTimeout((expirationDate.getTime() - new Date().getTime()) / 1000));\n    }\n  }\n}\nexport function* loginUserSaga(action) {\n  yield put(actions.authStart());\n  const authData = {\n    username: \"\",\n    email: action.email,\n    password: action.password\n  };\n  let url = \"login/\";\n\n  try {\n    constaction.res = yield axios.post(url, authData);\n    const expirationDate = new Date(new Date().getTime() + 3600 * 1000);\n    localStorage.setItem(\"token\", res.data.key);\n    localStorage.setItem(\"expirationDate\", expirationDate);\n    localStorage.setItem(\"userId\", action.email); // dispatch(getUserCredetials(authData))\n\n    yield put(actions.authSuccess(res.data.key, action.email));\n    yield put(actions.checkAuthTimeout(3600));\n  } catch (error) {\n    yield put(actions.authFail(error.response.data));\n  }\n}","map":{"version":3,"sources":["/Users/luispreciado/Documents/CSProjects/WebDevelopment/poke-api/gui/src/store/saga/auth.js"],"names":["put","delay","actions","axios","checkAuthTimeoutSaga","action","expirationTime","logoutSuccess","logoutSaga","localStorage","removeItem","url","res","post","data","error","authFail","response","authCheckState","token","getItem","logout","expirationDate","Date","userId","authSuccess","checkAuthTimeout","getTime","loginUserSaga","authStart","authData","username","email","password","constaction","setItem","key"],"mappings":"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","sourcesContent":["import { put, delay } from \"redux-saga/effects\";\nimport * as actions from \"../actions/index\";\nimport axios from \"../../axios/auth\";\n\nexport function* checkAuthTimeoutSaga(action) {\n  yield delay(action.expirationTime * 1000)\n  yield put(actions.logoutSuccess());\n}\n\nexport function* logoutSaga() {\n  localStorage.removeItem(\"token\");\n  localStorage.removeItem(\"expirationDate\");\n  localStorage.removeItem(\"userId\");\n  const url = \"logout/\";\n  try {\n    const res = yield axios.post(url);\n    yield put(actions.logoutSuccess(res.data));\n  } catch (error) {\n    yield put(actions.authFail(error.response.data));\n  }\n}\n\nexport function* authCheckState() {\n  const token = localStorage.getItem(\"token\");\n  if (!token) {\n    yield put(actions.logout());\n  } else {\n    const expirationDate = yield new Date(localStorage.getItem(\"expirationDate\"));\n    if (expirationDate <= new Date()) {\n      yield put(actions.logout());\n    } else {\n      const userId = localStorage.getItem(\"userId\");\n      yield put(actions.authSuccess(token, userId));\n      yield put(\n        actions.checkAuthTimeout(\n          (expirationDate.getTime() - new Date().getTime()) / 1000\n        )\n      );\n    }\n  }\n}\n\nexport function* loginUserSaga(action){\n    yield put(actions.authStart());\n    const authData = {\n      username: \"\",\n      email: action.email,\n      password: action.password\n    };\n    let url = \"login/\";\n    try{\n      constaction. res = yield axios.post(url, authData)\n      const expirationDate = new Date(new Date().getTime() + 3600 * 1000);\n\n        localStorage.setItem(\"token\", res.data.key);\n        localStorage.setItem(\"expirationDate\", expirationDate);\n        localStorage.setItem(\"userId\", action.email);\n        // dispatch(getUserCredetials(authData))\n        yield put(actions.authSuccess(res.data.key, action.email));\n        yield put(actions.checkAuthTimeout(3600));\n    }catch(error){\n      yield put(actions.authFail(error.response.data));\n    }\n}\n"]},"metadata":{},"sourceType":"module"}